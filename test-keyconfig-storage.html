<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§˜é’¥é…ç½®å­˜å‚¨æµ‹è¯•</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { margin: 5px; padding: 8px 16px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #f0f0f0; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” ç§˜é’¥é…ç½®å­˜å‚¨åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>æµ‹è¯•è¯´æ˜</h2>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ç§˜é’¥é…ç½®ç®¡ç†ç»„ä»¶çš„å­˜å‚¨åŠŸèƒ½ï¼š</p>
            <ul>
                <li>âœ… é…ç½®è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨</li>
                <li>âœ… é¡µé¢åˆ·æ–°åé…ç½®ä»ç„¶å­˜åœ¨</li>
                <li>âœ… å¯¼å…¥å¯¼å‡ºåŠŸèƒ½</li>
                <li>âœ… å­˜å‚¨é”™è¯¯å¤„ç†</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•æ­¥éª¤</h2>
            <ol>
                <li>åœ¨ä¸‹æ–¹çš„é…ç½®ç®¡ç†ç•Œé¢ä¸­åˆ›å»ºå‡ ä¸ªæµ‹è¯•é…ç½®</li>
                <li>åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥é…ç½®æ˜¯å¦ä»ç„¶å­˜åœ¨</li>
                <li>å°è¯•å¯¼å‡ºé…ç½®åˆ°æ–‡ä»¶</li>
                <li>æ¸…ç©ºé…ç½®åé‡æ–°å¯¼å…¥</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>é…ç½®ç®¡ç†ç•Œé¢</h2>
            <div id="root"></div>
        </div>

        <div class="test-section">
            <h2>å­˜å‚¨çŠ¶æ€ç›‘æ§</h2>
            <button onclick="checkStorage()">æ£€æŸ¥å­˜å‚¨çŠ¶æ€</button>
            <button onclick="clearStorage()">æ¸…ç©ºå­˜å‚¨</button>
            <div id="storage-log" class="log"></div>
        </div>
    </div>

    <script type="text/babel">
        // æ¨¡æ‹Ÿå­˜å‚¨å·¥å…·ç±»
        const StorageUtils = {
            async get(key) {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error('Storage get error:', error);
                    throw error;
                }
            },
            
            async set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error('Storage set error:', error);
                    throw error;
                }
            },
            
            async remove(key) {
                try {
                    localStorage.removeItem(key);
                } catch (error) {
                    console.error('Storage remove error:', error);
                    throw error;
                }
            }
        };

        // ç®€å•çš„ Toast å®ç°
        const toast = {
            success: (message) => {
                console.log('âœ… Success:', message);
                alert('Success: ' + message);
            },
            error: (message) => {
                console.error('âŒ Error:', message);
                alert('Error: ' + message);
            },
            info: (message) => {
                console.log('â„¹ï¸ Info:', message);
            }
        };

        // æ¨¡æ‹Ÿ UI ç»„ä»¶
        const Card = ({ children, className = '' }) => (
            <div className={`border rounded-lg p-4 ${className}`}>
                {children}
            </div>
        );
        
        const CardHeader = ({ children }) => (
            <div className="border-b pb-3 mb-3">
                {children}
            </div>
        );
        
        const CardTitle = ({ children }) => (
            <h3 className="text-lg font-semibold">
                {children}
            </h3>
        );
        
        const CardContent = ({ children }) => (
            <div>
                {children}
            </div>
        );
        
        const Button = ({ children, onClick, variant = 'default', size = 'default', disabled = false, className = '' }) => {
            const baseClasses = 'px-4 py-2 rounded-md font-medium transition-colors';
            const variants = {
                default: 'bg-blue-500 text-white hover:bg-blue-600',
                secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300',
                outline: 'border border-gray-300 text-gray-700 hover:bg-gray-50',
                destructive: 'bg-red-500 text-white hover:bg-red-600'
            };
            const sizes = {
                default: 'h-10 px-4 py-2',
                sm: 'h-9 px-3 py-1.5 text-sm',
                lg: 'h-11 px-8 py-3'
            };
            
            return (
                <button
                    className={`${baseClasses} ${variants[variant]} ${sizes[size]} ${className} ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}
                    onClick={onClick}
                    disabled={disabled}
                >
                    {children}
                </button>
            );
        };
        
        const Input = ({ value, onChange, placeholder, className = '' }) => (
            <input
                type="text"
                value={value}
                onChange={onChange}
                placeholder={placeholder}
                className={`border rounded-md px-3 py-2 w-full ${className}`}
            />
        );
        
        const Textarea = ({ value, onChange, placeholder, className = '', rows = 3 }) => (
            <textarea
                value={value}
                onChange={onChange}
                placeholder={placeholder}
                className={`border rounded-md px-3 py-2 w-full font-mono ${className}`}
                rows={rows}
            />
        );
        
        // ç®€åŒ–çš„ç§˜é’¥é…ç½®ç®¡ç†ç»„ä»¶
        function KeyConfigManager({ onConfigChange, initialConfigs = [], storageKey = 'keyConfigs' }) {
            const [configs, setConfigs] = React.useState(initialConfigs);
            const [selectedConfig, setSelectedConfig] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);

            // åˆå§‹åŒ–ï¼šä»å­˜å‚¨åŠ è½½é…ç½®
            React.useEffect(() => {
                loadConfigsFromStorage();
            }, []);

            const loadConfigsFromStorage = async () => {
                try {
                    setIsLoading(true);
                    const storedConfigs = await StorageUtils.get(storageKey);
                    
                    if (storedConfigs && Array.isArray(storedConfigs) && storedConfigs.length > 0) {
                        setConfigs(storedConfigs);
                        if (storedConfigs.length > 0) {
                            setSelectedConfig(storedConfigs[0].name);
                            onConfigChange?.(storedConfigs[0]);
                        }
                    } else if (initialConfigs.length > 0) {
                        await StorageUtils.set(storageKey, initialConfigs);
                        setConfigs(initialConfigs);
                        if (initialConfigs.length > 0) {
                            setSelectedConfig(initialConfigs[0].name);
                            onConfigChange?.(initialConfigs[0]);
                        }
                    }
                } catch (error) {
                    console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                    toast.error('åŠ è½½é…ç½®å¤±è´¥: ' + error.message);
                } finally {
                    setIsLoading(false);
                }
            };

            const saveConfigsToStorage = async (newConfigs) => {
                try {
                    await StorageUtils.set(storageKey, newConfigs);
                    return true;
                } catch (error) {
                    console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                    toast.error('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message);
                    return false;
                }
            };

            const addTestConfig = async () => {
                const newConfig = {
                    name: `æµ‹è¯•é…ç½®_${Date.now()}`,
                    algorithm: 'AES',
                    mode: 'CBC',
                    padding: 'PKCS7',
                    key: 'test-key-' + Math.random().toString(36).substr(2, 16),
                    keyEncoding: 'UTF-8',
                    iv: 'test-iv-' + Math.random().toString(36).substr(2, 16),
                    ivEncoding: 'UTF-8',
                    plaintextEncoding: 'UTF-8',
                    ciphertextEncoding: 'BASE64',
                    createdAt: Date.now()
                };

                const updatedConfigs = [...configs, newConfig];
                const success = await saveConfigsToStorage(updatedConfigs);
                
                if (success) {
                    setConfigs(updatedConfigs);
                    setSelectedConfig(newConfig.name);
                    toast.success('æµ‹è¯•é…ç½®å·²åˆ›å»ºå¹¶ä¿å­˜');
                }
            };

            const clearAllConfigs = async () => {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é…ç½®å—ï¼Ÿ')) {
                    const success = await saveConfigsToStorage([]);
                    
                    if (success) {
                        setConfigs([]);
                        setSelectedConfig('');
                        toast.success('æ‰€æœ‰é…ç½®å·²æ¸…ç©º');
                    }
                }
            };

            return (
                <div className="space-y-4">
                    {isLoading && (
                        <div className="text-center py-4">
                            <div>åŠ è½½é…ç½®ä¸­...</div>
                        </div>
                    )}
                    
                    <Card>
                        <CardHeader>
                            <CardTitle className="flex items-center justify-between">
                                <span>ğŸ” ç§˜é’¥é…ç½®ç®¡ç†</span>
                                <div className="flex gap-2">
                                    <Button 
                                        variant="outline" 
                                        size="sm"
                                        onClick={loadConfigsFromStorage}
                                        disabled={isLoading}
                                    >
                                        ğŸ”„ åˆ·æ–°
                                    </Button>
                                    <Button 
                                        variant="secondary" 
                                        size="sm"
                                        onClick={addTestConfig}
                                        disabled={isLoading}
                                    >
                                        â• æ·»åŠ æµ‹è¯•é…ç½®
                                    </Button>
                                    <Button 
                                        variant="destructive" 
                                        size="sm"
                                        onClick={clearAllConfigs}
                                        disabled={configs.length === 0 || isLoading}
                                    >
                                        ğŸ—‘ï¸ æ¸…ç©º
                                    </Button>
                                </div>
                            </CardTitle>
                        </CardHeader>
                        <CardContent>
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h3 className="text-lg font-semibold">é…ç½®åˆ—è¡¨</h3>
                                    <div className="text-sm text-gray-500">
                                        å…± {configs.length} ä¸ªé…ç½® {isLoading && '(åŠ è½½ä¸­...)'}
                                    </div>
                                </div>
                                
                                <div className="space-y-2 max-h-64 overflow-y-auto border rounded-lg p-2">
                                    {configs.length > 0 ? (
                                        configs.map((config) => (
                                            <div 
                                                key={config.name}
                                                className={`p-3 rounded-lg border cursor-pointer transition-colors ${
                                                    selectedConfig === config.name 
                                                        ? 'bg-blue-50 border-blue-500' 
                                                        : 'hover:bg-gray-50'
                                                }`}
                                                onClick={() => setSelectedConfig(config.name)}
                                            >
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <div className="font-medium">{config.name}</div>
                                                        <div className="text-sm text-gray-500 mt-1">
                                                            <span className="inline-block mr-3">ç®—æ³•: {config.algorithm}</span>
                                                            <span className="inline-block mr-3">ç¼–ç : {config.plaintextEncoding}</span>
                                                            <span className="inline-block">åˆ›å»ºæ—¶é—´: {new Date(config.createdAt).toLocaleString()}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="text-center py-8 text-gray-500">
                                            æš‚æ— é…ç½®ï¼Œè¯·ç‚¹å‡»"æ·»åŠ æµ‹è¯•é…ç½®"æŒ‰é’®
                                        </div>
                                    )}
                                </div>
                                
                                {selectedConfig && (
                                    <div className="mt-4 p-3 bg-gray-50 rounded-lg">
                                        <div className="text-sm text-gray-600 space-y-1">
                                            <div>
                                                å½“å‰é…ç½®: <span className="font-medium">{selectedConfig}</span>
                                            </div>
                                            <div>
                                                ç®—æ³•: <span className="font-medium">
                                                    {configs.find(c => c.name === selectedConfig)?.algorithm || 'æœªè®¾ç½®'}
                                                </span>
                                            </div>
                                            <div>
                                                åˆ›å»ºæ—¶é—´: <span className="font-medium">
                                                    {new Date(configs.find(c => c.name === selectedConfig)?.createdAt).toLocaleString()}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </CardContent>
                    </Card>
                </div>
            );
        }

        // æ¸²æŸ“ç»„ä»¶
        function App() {
            const handleConfigChange = (config) => {
                console.log('é…ç½®å˜æ›´:', config);
            };

            return (
                <KeyConfigManager 
                    onConfigChange={handleConfigChange}
                    storageKey="test-key-configs"
                />
            );
        }

        // æŒ‚è½½åº”ç”¨
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // å­˜å‚¨ç›‘æ§å‡½æ•°
        function checkStorage() {
            const logDiv = document.getElementById('storage-log');
            try {
                const configs = localStorage.getItem('test-key-configs');
                const parsed = configs ? JSON.parse(configs) : null;
                
                logDiv.innerHTML = `
                    <div><strong>å­˜å‚¨é”®:</strong> test-key-configs</div>
                    <div><strong>æ˜¯å¦å­˜åœ¨:</strong> ${!!configs}</div>
                    <div><strong>é…ç½®æ•°é‡:</strong> ${parsed ? parsed.length : 0}</div>
                    <div><strong>åŸå§‹æ•°æ®:</strong> ${configs || 'null'}</div>
                    <div><strong>è§£æç»“æœ:</strong> ${JSON.stringify(parsed, null, 2)}</div>
                `;
            } catch (error) {
                logDiv.innerHTML = `<div style="color: red;">é”™è¯¯: ${error.message}</div>`;
            }
        }

        function clearStorage() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå­˜å‚¨å—ï¼Ÿ')) {
                localStorage.removeItem('test-key-configs');
                checkStorage();
                toast.success('å­˜å‚¨å·²æ¸…ç©º');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥å­˜å‚¨
        window.addEventListener('load', () => {
            setTimeout(checkStorage, 1000);
        });
    </script>
</body>
</html>