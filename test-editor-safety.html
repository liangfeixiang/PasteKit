<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®ç¼–è¾‘å™¨ç©ºå€¼é”™è¯¯ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 bg-gray-50">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">ğŸ”§ é…ç½®ç¼–è¾‘å™¨ç©ºå€¼é”™è¯¯ä¿®å¤</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">é”™è¯¯åˆ†æä¸ä¿®å¤</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                    <h3 class="font-medium text-red-800 mb-2">âŒ åŸå§‹é”™è¯¯</h3>
                    <div class="text-sm text-red-700">
                        <p><strong>é”™è¯¯ä¿¡æ¯:</strong> Cannot read properties of undefined (reading 'value')</p>
                        <p><strong>å‘ç”Ÿä½ç½®:</strong> ConfigEditor ç»„ä»¶ç¬¬763è¡Œ</p>
                        <p><strong>åŸå› :</strong> editedConfig.key æˆ– editedConfig.iv ä¸º undefined</p>
                    </div>
                </div>
                
                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                    <h3 class="font-medium text-green-800 mb-2">âœ… ä¿®å¤æ–¹æ¡ˆ</h3>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>â€¢ é…ç½®å¯¹è±¡æ ‡å‡†åŒ–å¤„ç†</li>
                        <li>â€¢ ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ (?.)</li>
                        <li>â€¢ æ·»åŠ é»˜è®¤å€¼å›é€€æœºåˆ¶</li>
                        <li>â€¢ ç»Ÿä¸€ç©ºå€¼æ£€æŸ¥é€»è¾‘</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">æµ‹è¯•ç”¨ä¾‹æ¼”ç¤º</h2>
            
            <div class="space-y-4">
                <div class="border rounded-lg p-4">
                    <h3 class="font-medium mb-3">ğŸ“‹ æµ‹è¯•é…ç½®ç±»å‹</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-3 bg-blue-50 rounded">
                            <h4 class="font-medium text-blue-800 mb-2">å®Œæ•´é…ç½®</h4>
                            <pre class="text-xs bg-white p-2 rounded">{ name: "å®Œæ•´é…ç½®", key: { value: "test", encoding: ["HEX"] }, iv: { value: "iv", encoding: ["UTF8"] } }</pre>
                        </div>
                        
                        <div class="p-3 bg-yellow-50 rounded">
                            <h4 class="font-medium text-yellow-800 mb-2">ç¼ºå¤±key/iv</h4>
                            <pre class="text-xs bg-white p-2 rounded">{ name: "ä¸å®Œæ•´é…ç½®" }</pre>
                        </div>
                        
                        <div class="p-3 bg-purple-50 rounded">
                            <h4 class="font-medium text-purple-800 mb-2">æ–°æ ¼å¼é…ç½®</h4>
                            <pre class="text-xs bg-white p-2 rounded">{ name: "æ–°æ ¼å¼", key: { value: "", encoding: ["BASE64"] } }</pre>
                        </div>
                        
                        <div class="p-3 bg-gray-50 rounded">
                            <h4 class="font-medium text-gray-800 mb-2">ç©ºé…ç½®</h4>
                            <pre class="text-xs bg-white p-2 rounded">{}</pre>
                        </div>
                    </div>
                </div>
                
                <div class="border rounded-lg p-4">
                    <h3 class="font-medium mb-3">ğŸ”§ ä¿®å¤åçš„å®‰å…¨è®¿é—®</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">å¯†é’¥è¾“å…¥:</h4>
                            <code class="bg-gray-100 p-2 rounded block">
                                value={editedConfig.key?.value || ''}
                            </code>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">ç¼–ç é€‰æ‹©:</h4>
                            <code class="bg-gray-100 p-2 rounded block">
                                value={editedConfig.key?.encoding?.[0] || 'HEX'}
                            </code>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">éªŒè¯é€»è¾‘:</h4>
                            <code class="bg-gray-100 p-2 rounded block">
                                if (!editedConfig.key?.value?.trim())
                            </code>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">é…ç½®åˆå§‹åŒ–:</h4>
                            <code class="bg-gray-100 p-2 rounded block">
                                key: config.key || { value: '', encoding: ['HEX'] }
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center">
            <button onclick="runSafetyTests()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 mr-4">
                ğŸ§ª è¿è¡Œå®‰å…¨æ€§æµ‹è¯•
            </button>
            <button onclick="testEdgeCases()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 mr-4">
                ğŸ¯ æµ‹è¯•è¾¹ç•Œæƒ…å†µ
            </button>
            <button onclick="clearLogs()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                ğŸ§¹ æ¸…é™¤æ—¥å¿—
            </button>
        </div>
        
        <div class="mt-6 bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
            <div id="test-console" class="h-80 overflow-y-auto">
                > æµ‹è¯•æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const consoleEl = document.getElementById('test-console');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-yellow-400';
            consoleEl.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
            console.log(message);
        }
        
        function clearLogs() {
            document.getElementById('test-console').innerHTML = '> æ§åˆ¶å°å·²æ¸…ç©º...\n';
        }
        
        function runSafetyTests() {
            clearLogs();
            log('ğŸ§ª å¼€å§‹è¿è¡Œé…ç½®ç¼–è¾‘å™¨å®‰å…¨æ€§æµ‹è¯•...', 'info');
            
            // æ¨¡æ‹Ÿå„ç§é…ç½®æƒ…å†µ
            const testConfigs = [
                {
                    name: 'å®Œæ•´é…ç½®',
                    config: {
                        name: 'æµ‹è¯•é…ç½®1',
                        key: { value: 'a1b2c3d4', encoding: ['HEX'] },
                        iv: { value: '01234567', encoding: ['UTF8'] },
                        plainEncoding: ['UTF8'],
                        cipherEncoding: ['BASE64']
                    }
                },
                {
                    name: 'ç¼ºå¤±key/ivå­—æ®µ',
                    config: {
                        name: 'æµ‹è¯•é…ç½®2'
                        // æ•…æ„ç¼ºå°‘ key å’Œ iv å­—æ®µ
                    }
                },
                {
                    name: 'key/ivä¸ºnull',
                    config: {
                        name: 'æµ‹è¯•é…ç½®3',
                        key: null,
                        iv: null
                    }
                },
                {
                    name: 'ç©ºå¯¹è±¡é…ç½®',
                    config: {}
                },
                {
                    name: 'éƒ¨åˆ†ç¼ºå¤±é…ç½®',
                    config: {
                        name: 'æµ‹è¯•é…ç½®5',
                        key: { value: 'test' } // ç¼ºå°‘ encoding
                    }
                }
            ];
            
            testConfigs.forEach((testCase, index) => {
                log(`\n--- æµ‹è¯• ${index + 1}: ${testCase.name} ---`, 'info');
                
                try {
                    // æ¨¡æ‹Ÿé…ç½®æ ‡å‡†åŒ–è¿‡ç¨‹
                    const normalizedConfig = {
                        ...testCase.config,
                        key: testCase.config.key || { value: '', encoding: ['HEX'] },
                        iv: testCase.config.iv || { value: '', encoding: ['UTF8'] },
                        plainEncoding: testCase.config.plainEncoding || ['UTF8'],
                        cipherEncoding: testCase.config.cipherEncoding || ['BASE64']
                    };
                    
                    log(`âœ… é…ç½®æ ‡å‡†åŒ–æˆåŠŸ`, 'success');
                    log(`   key.value: "${normalizedConfig.key?.value || 'undefined'}"`, 'info');
                    log(`   key.encoding[0]: "${normalizedConfig.key?.encoding?.[0] || 'undefined'}"`, 'info');
                    log(`   iv.value: "${normalizedConfig.iv?.value || 'undefined'}"`, 'info');
                    
                    // æµ‹è¯•å®‰å…¨è®¿é—®
                    const keyValue = normalizedConfig.key?.value || '';
                    const keyEncoding = normalizedConfig.key?.encoding?.[0] || 'HEX';
                    const ivValue = normalizedConfig.iv?.value || '';
                    const plainEncoding = normalizedConfig.plainEncoding?.[0] || 'UTF8';
                    
                    log(`âœ… å®‰å…¨è®¿é—®æµ‹è¯•é€šè¿‡`, 'success');
                    log(`   å®‰å…¨keyå€¼: "${keyValue}"`, 'info');
                    log(`   å®‰å…¨ç¼–ç : "${keyEncoding}"`, 'info');
                    
                } catch (error) {
                    log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            log('\nğŸ‰ å®‰å…¨æ€§æµ‹è¯•å®Œæˆ!', 'success');
        }
        
        function testEdgeCases() {
            clearLogs();
            log('ğŸ¯ å¼€å§‹è¾¹ç•Œæƒ…å†µæµ‹è¯•...', 'info');
            
            const edgeCases = [
                {
                    desc: 'undefinedé…ç½®',
                    config: undefined
                },
                {
                    desc: 'nullé…ç½®', 
                    config: null
                },
                {
                    desc: 'åµŒå¥—undefined',
                    config: { key: { value: undefined, encoding: undefined } }
                },
                {
                    desc: 'ç©ºæ•°ç»„ç¼–ç ',
                    config: { key: { value: 'test', encoding: [] } }
                },
                {
                    desc: 'ç¼–ç ä¸ºnull',
                    config: { key: { value: 'test', encoding: null } }
                }
            ];
            
            edgeCases.forEach((testCase, index) => {
                log(`\n--- è¾¹ç•Œæµ‹è¯• ${index + 1}: ${testCase.desc} ---`, 'info');
                
                try {
                    // å®‰å…¨çš„é…ç½®å¤„ç†
                    const safeConfig = testCase.config || {};
                    const keyObj = safeConfig.key || { value: '', encoding: ['HEX'] };
                    const keyValue = keyObj.value || '';
                    const keyEncoding = (keyObj.encoding && keyObj.encoding[0]) || 'HEX';
                    
                    log(`âœ… è¾¹ç•Œæƒ…å†µå¤„ç†æˆåŠŸ`, 'success');
                    log(`   å¤„ç†åçš„keyå€¼: "${keyValue}"`, 'info');
                    log(`   å¤„ç†åçš„ç¼–ç : "${keyEncoding}"`, 'info');
                    
                } catch (error) {
                    log(`âŒ è¾¹ç•Œæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            });
            
            log('\nğŸ¯ è¾¹ç•Œæƒ…å†µæµ‹è¯•å®Œæˆ!', 'success');
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                runSafetyTests();
            }, 1000);
        });
    </script>
</body>
</html>